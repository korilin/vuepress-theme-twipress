(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{415:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("本文章是在发布 web-mysql 和 nested-list 时根据官方教程在实践后后写下的，可以边参考官方教程边阅读本文章，这样可能有助于您理解如何去把项目打包成一个 pip 软件包")]),t._v(" "),a("p",[t._v("本人使用的是 Python3, 操作可能会和 Python2 有点不同，同时使用的命令是参考了其他的教程，和官方命令也不太一样，免去了许多参数的选择，更加简单。")]),t._v(" "),a("p",[t._v("如果希望更加全面地理解和打包 pip 软件包请参考")]),t._v(" "),a("p",[t._v("官方教程："),a("a",{attrs:{href:"https://packaging.python.org/tutorials/packaging-projects/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://packaging.python.org/tutorials/packaging-projects/"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"需要使用到的东西"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要使用到的东西"}},[t._v("#")]),t._v(" 需要使用到的东西")]),t._v(" "),a("p",[t._v("两个 Python 包：setuptools、twine")]),t._v(" "),a("p",[t._v("一个 PyPI 账号："),a("a",{attrs:{href:"https://pypi.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pypi.org/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("打一个 pip 软件包一定要有这两个工具，setuptools 用于创建构建脚本，twine 用于上传项目，上传的 pip 包都会放在这里 PyPI")]),t._v(" "),a("h2",{attrs:{id:"打包一个项目的文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包一个项目的文件结构"}},[t._v("#")]),t._v(" 打包一个项目的文件结构")]),t._v(" "),a("div",{staticClass:"language-Text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("软件包根目录/\n    打包的项目/\n        __init__.py\n        ...\n    setup.py\n    LICENSE\n    README.md\n")])])]),a("p",[t._v("根目录的名字不知道对项目名有没有影响，我都是直接取发行名称")]),t._v(" "),a("p",[t._v("在这个目录下，最简单的配置包括 4 个部分：")]),t._v(" "),a("div",{staticClass:"language-Text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("要打包的项目：你准备打包成pip包的项目\nsetup.py：构建脚本, 里面写的是软件包的相关信息和代码配置信息\nLICENSE：软件包使用的许可证\nREADME.md：说明文件\n")])])]),a("h2",{attrs:{id:"打包配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包配置"}},[t._v("#")]),t._v(" 打包配置")]),t._v(" "),a("p",[t._v("打包的项目就不说了，可能你是直接打包已有项目，也可能是打算打包从头写的项目，打包的关键步骤主要是 setup.py 的配置和上传命令的使用，上传项目时软件包的信息都是根据 setup 里面的配置来上传的")]),t._v(" "),a("p",[a("strong",[t._v("把官方 setup.py 的配置简化一下就是以下的样子，三个点代表省略：")])]),t._v(" "),a("div",{staticClass:"language-Python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" setuptools\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里从README导入详细说明")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"README.md"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" fh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    long_description "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsetuptools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example-pkg-YOUR-USERNAME-HERE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pip软件包发行的名称")]),t._v("\n    version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本次上传的版本")]),t._v("\n    author"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Example Author"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作者名称")]),t._v("\n    author_email"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"author@example.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作者邮箱")]),t._v("\n    description"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A small example package"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包摘要")]),t._v("\n    long_description"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("long_description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包详细说明")]),t._v("\n    long_description_content_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/markdown"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引用详细说明的文件格式")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://github.com/pypa/sampleproject"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 项目的主页地址, 大部分是使用该项目在自己代码储存库的地址")]),t._v("\n    license"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MIT"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 许可证类型")]),t._v("\n    packages"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("setuptools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_packages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 要打包的所有Python包列表")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是列出了你的包的额外元数据, 给你的包进行分类, 下面的意思是“该软件包仅与Python 3兼容, 已获得MIT许可, 与操作系统无关”")]),t._v("\n    classifiers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Programming Language :: Python :: 3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"License :: OSI Approved :: MIT License"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Operating System :: OS Independent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 能够使用你的项目的Python版本")]),t._v("\n    python_requires"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'>=3.6'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你的项目的依赖项, 安装你的软件包时, pip也会自动安装以下依赖项, 举个例子--pymysql")]),t._v("\n    install_requires "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pymysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("官方全部字段的配置说明："),a("a",{attrs:{href:"https://packaging.python.org/guides/distributing-packages-using-setuptools/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://packaging.python.org/guides/distributing-packages-using-setuptools/"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("配置文件的时候有几个注意点：")])]),t._v(" "),a("ol",[a("li",[t._v("上传不同版本的软件包，version 要修改，因为生成的压缩包版本后缀是根据这一行配置的")]),t._v(" "),a("li",[t._v("packages 可以手动列出需要打包的 Python 包列表，如果使用"),a("code",[t._v("find_package()")]),t._v("的话则是脚本自动发现所有软件包和子软件包")]),t._v(" "),a("li",[t._v("关于 classifiers 的配置根据不同项目配置都不一样，参考官方分类器列表："),a("a",{attrs:{href:"https://pypi.org/classifiers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pypi.org/classifiers/"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("如果设置了 python_requires, 那么所有不符合要求的 Python 版本都会被 pip 阻止安装这个软件包")])]),t._v(" "),a("p",[a("strong",[t._v("配置完 setup.py, 接下来就是根据你的需要选择许可证："),a("a",{attrs:{href:"https://choosealicense.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://choosealicense.com/"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("选择完许可证要把许可证文本写入 LICENSE 文件，或者也可以在使用 GitHub Desktop 创建仓库时创建许可证，如果 setup.py 里有配置 license 这一项记得修改成对应的类型")])]),t._v(" "),a("h2",{attrs:{id:"打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[t._v("#")]),t._v(" 打包")]),t._v(" "),a("p",[t._v("打包前，要先 check 一下，看看 setup 的配置是否有效")]),t._v(" "),a("p",[t._v("在软件包根目录使用命令："),a("code",[t._v("setup.py check")])]),t._v(" "),a("p",[t._v("如果只显示了 running check 就是正常的")]),t._v(" "),a("p",[t._v("如果没问题使用 sdist 进行打包")]),t._v(" "),a("p",[a("code",[t._v("setup.py sdist")])]),t._v(" "),a("p",[t._v("生成的压缩包会放在 dist/ 下面，把这些包上传就完成了，但是上传前还要进行一次检查，看看压缩包是否符合要求")]),t._v(" "),a("p",[t._v("检查命令："),a("code",[t._v("twine check dist/*")])]),t._v(" "),a("p",[t._v("上传命令："),a("code",[t._v("twine upload dist/*")])]),t._v(" "),a("p",[t._v("输入用户名和密码就可以了")]),t._v(" "),a("p",[a("strong",[t._v("这里也有几个注意点：")])]),t._v(" "),a("ol",[a("li",[t._v("有些教程会使用"),a("code",[t._v("setup.py register")]),t._v("来进行注册上传，但是这个方法其实已经弃用了，官方推荐是直接使用"),a("code",[t._v("twine upload")])]),t._v(" "),a("li",[t._v("dist/*是指 dist 下的全部文件，如果上传的压缩包含有以前的版本，因为该版本已经上传过了，会有错误提示，可以把以前版本的压缩包删掉，也可以自己选择上传的包，而不是全部上传")]),t._v(" "),a("li",[t._v("我这里没有配置用户文件，配置文件可以免去验证用户的流程")]),t._v(" "),a("li",[t._v("官方推荐是注册令牌来代替用户名和密码上传，注册令牌是一种更安全可靠的方式")])]),t._v(" "),a("p",[t._v("如果以上步骤都没问题，你就可以在自己的账号上面看到上传的 pip 软件包了")])])}),[],!1,null,null,null);s.default=e.exports}}]);